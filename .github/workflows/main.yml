name: ci

on: [push]

jobs:
#   wait_for_vercel:
#     name: Wait for vercel
#     runs-on: ubuntu-latest
#     outputs:
#       preview_url: ${{ steps.waitForVercelPreviewDeployment.outputs.url }}
#     steps:
#       - name: Wait for Vercel preview deployment to be ready
#         uses: patrickedqvist/wait-for-vercel-preview@main
#         id: waitForVercelPreviewDeployment
#         with:
#           token: ${{ secrets.GITHUB_TOKEN }}
#           max_timeout: 120
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Test using Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '16'
      - run: yarn install
      - run: yarn test

      - name: Tests âœ…
        if: ${{ success() }}
        run: |
          curl --request POST \
          --url https://api.github.com/repos/${{ github.repository }}/statuses/${{ github.sha }} \
          --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
          --header 'content-type: application/json' \
          --data '{
            "context": "tests",
            "state": "success",
            "description": "Tests passed",
            "target_url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          }'

      - name: Tests ðŸš¨
        if: ${{ failure() }}
        run: |
          curl --request POST \
          --url https://api.github.com/repos/${{ github.repository }}/statuses/${{ github.sha }} \
          --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
          --header 'content-type: application/json' \
          --data '{
            "context": "tests",
            "state": "failure",
            "description": "Tests failed",
            "target_url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          }'
  # pa11y:
  #   name: Accessibility tests
  #   needs: wait_for_vercel
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: actions/setup-node@v1
  #       with:
  #         node-version: 14.x
  #     - run: npm install -g pa11y-ci
  #     - run: pa11y-ci --sitemap ${{ needs.wait_for_vercel.outputs.preview_url }}/sitemap-0.xml
